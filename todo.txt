query db by reference and verse when available
split view and controller
check protection against sql injection
refactor and tidy